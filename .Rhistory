),
width = 3,
linetype = "solid"
) +
facet_wrap(vars(depth.str), ncol = 1) +
theme_bw() +
labs(
x = "Incubation Time (Days)",
y = "Total Sulfide (µM)"
)
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
clines_wctls |>
mutate(depth.str = paste(depth, "m")) |>
mutate(depth.str = fct_reorder(.f = depth.str, .x = depth)) |>
ggplot(
aes(x = dt,
y = conc.um,
color = amendment,
linetype = amendment,
shape = amendment)
) +
geom_point() +
scale_color_manual(values = amendment_palette) +
geom_line() +
geom_errorbar(aes(
ymin = conc.um - sd.conc.um,
ymax = conc.um + sd.conc.um
),
width = 3,
linetype = "solid"
) +
facet_wrap(vars(well, depth.str), ncol = 1) +
theme_bw() +
labs(
x = "Incubation Time (Days)",
y = "Total Sulfide (µM)"
)
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
clines_wctls |>
mutate(depth.str = paste(depth, "m")) |>
mutate(depth.str = fct_reorder(.f = depth.str, .x = depth)) |>
ggplot(
aes(x = dt,
y = conc.um,
color = amendment,
linetype = amendment,
shape = amendment)
) +
geom_point() +
scale_color_manual(values = amendment_palette) +
geom_line() +
geom_errorbar(aes(
ymin = conc.um - sd.conc.um,
ymax = conc.um + sd.conc.um
),
width = 3,
linetype = "solid"
) +
facet_wrap(vars(well, depth.str)) +
theme_bw() +
labs(
x = "Incubation Time (Days)",
y = "Total Sulfide (µM)"
)
library(tidyverse)
library(lubridate)
gc_data0 <- readRDS("cache/gc_samples0.RDS")
gc_data1 <- readRDS("cache/gc_samples1.RDS")
gc_data <- bind_rows(gc_data0, gc_data1) |>
mutate(dt = case_when(
is.na(sample_set) ~ 33,
sample_set == "A" ~ 60,
sample_set == "B" ~ 114
))
# Chunk 1
library(tidyverse)
library(lubridate)
# Chunk 2
gc_data0 <- readRDS("cache/gc_samples0.RDS")
gc_data1 <- readRDS("cache/gc_samples1.RDS")
# Chunk 3
gc_data <- bind_rows(gc_data0, gc_data1) |>
mutate(dt = case_when(
is.na(sample_set) ~ 33,
sample_set == "A" ~ 60,
sample_set == "B" ~ 114
))
# Chunk 4
t0 <- tibble(
well = c("BA3A", "BA4A", "BA1B")
) |>
crossing(
depth = c(20, 150, 270),
amendment = c("Bicarbonate", "Formate", "Acetate"),
gas = c("CH4", "CO2")
) |>
mutate(
depth = case_when(
depth == 270 & well == "BA1B" ~ 250,
TRUE ~ depth
)
) |>
mutate(nmol_per_ml = 0,
dt = 0)
gc_data <- gc_data |> bind_rows(t0)
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
gc_data |>
filter(gas == "CH4") |>
ggplot(
aes(x = dt,
y = nmol_per_ml,
color = amendment,
shape = amendment,
linetype = amendment
)
) +
geom_point() +
geom_line() +
facet_wrap(vars(well, depth)) +
scale_color_manual(values = amendment_palette) +
#scale_x_continuous(breaks = c(0, 30, 60, 120)) +
theme_bw() +
labs(
x = "Incubation time (days)",
y = latex2exp::TeX("nmol $CH_4$ $ml^{-1}$")
) +
theme(
strip.background = element_rect(fill = "#e3e3e3", color = NA),
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
strip.background.x = element_rect(fill = "black"),
strip.text = element_text(color = "white"),
panel.border = element_rect(linewidth = 1.2, color = "black"),
axis.ticks.x = element_blank(),
#legend.position = "None"
)
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
gc_data |>
filter(gas == "CH4") |>
ggplot(
aes(x = dt,
y = nmol_per_ml,
color = amendment,
shape = amendment,
linetype = amendment
)
) +
geom_point() +
geom_line() +
facet_wrap(vars(well, depth), scales = "free_y") +
scale_color_manual(values = amendment_palette) +
#scale_x_continuous(breaks = c(0, 30, 60, 120)) +
theme_bw() +
labs(
x = "Incubation time (days)",
y = latex2exp::TeX("nmol $CH_4$ $ml^{-1}$")
) +
theme(
strip.background = element_rect(fill = "#e3e3e3", color = NA),
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
strip.background.x = element_rect(fill = "black"),
strip.text = element_text(color = "white"),
panel.border = element_rect(linewidth = 1.2, color = "black"),
axis.ticks.x = element_blank(),
#legend.position = "None"
)
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
gc_data |>
filter(gas == "CO2") |>
ggplot(
aes(x = dt,
y = nmol_per_ml,
color = amendment,
shape = amendment,
linetype = amendment
)
) +
geom_point() +
geom_line() +
facet_wrap(vars(well, depth), scales = "free_y ") +
scale_color_manual(values = amendment_palette) +
#scale_x_continuous(breaks = c(0, 30, 60, 120)) +
theme_bw() +
labs(
x = "Incubation time (days)",
y = latex2exp::TeX("nmol $CH_4$ $ml^{-1}$")
) +
theme(
strip.background = element_rect(fill = "#e3e3e3", color = NA),
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
strip.background.x = element_rect(fill = "black"),
strip.text = element_text(color = "white"),
panel.border = element_rect(linewidth = 1.2, color = "black"),
axis.ticks.x = element_blank(),
#legend.position = "None"
)
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
gc_data |>
filter(gas == "CO2") |>
ggplot(
aes(x = dt,
y = nmol_per_ml,
color = amendment,
shape = amendment,
linetype = amendment
)
) +
geom_point() +
geom_line() +
facet_wrap(vars(well, depth), scales = "free_y") +
scale_color_manual(values = amendment_palette) +
#scale_x_continuous(breaks = c(0, 30, 60, 120)) +
theme_bw() +
labs(
x = "Incubation time (days)",
y = latex2exp::TeX("nmol $CH_4$ $ml^{-1}$")
) +
theme(
strip.background = element_rect(fill = "#e3e3e3", color = NA),
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
strip.background.x = element_rect(fill = "black"),
strip.text = element_text(color = "white"),
panel.border = element_rect(linewidth = 1.2, color = "black"),
axis.ticks.x = element_blank(),
#legend.position = "None"
)
# Chunk 1
# Clear the environment
rm(list=ls())
# Chunk 2
library(tidyverse)
library(plater)
library(ggpmisc)
# Chunk 3
plate_list <- list.files(path = "data/cline_assays/2023-06-05-Clines/csvs")
plate_list <- plate_list[!grepl("map", plate_list)]
plate_list2 <- str_c("data/cline_assays/2023-06-05-Clines/csvs/", plate_list)
plate_names <- plate_list |> str_remove(".csv") |> str_to_lower()
data <- read_plates(
files = plate_list2,
plate_names = plate_names,
well_ids_column = "Wells"
) |>
rename(plate_id = Plate) |>
mutate(Plate = case_when(
str_detect(plate_id, "platea") ~ "platea",
str_detect(plate_id, "plateb") ~ "plateb",
str_detect(plate_id, "platec") ~ "platec"
))
# Chunk 4
map_list <- list.files(path = "data/cline_assays/2023-06-05-Clines/csvs")
map_list <- map_list[grepl("map", map_list)]
map_list <- str_c("data/cline_assays/2023-06-05-Clines/csvs/", map_list)
maps <- read_plates(files = map_list) |>
mutate(
Plate = str_remove(Plate, pattern = "map") |> str_to_lower(),
sample_id = case_when(
!is.na(`PLATE A`) ~ `PLATE A`,
!is.na(`PLATE B`) ~ `PLATE B`,
!is.na(`PLATE C`) ~ `PLATE C`
)
) |>
select(c(Plate, Wells, sample_id))
# Chunk 5
standard_concs <- readxl::read_excel("data/cline_assays/2023-05-29-Clines/standards_concentration.xlsx")
# Chunk 6
diluted_samples <- readxl::read_excel("data/cline_assays/2023-06-05-Clines/diluted_samples.xlsx") |> pull()
# Chunk 7
cline_data <- data |>
left_join(maps,
by = c("Plate", "Wells")) |>
# add standard info
mutate(
is.standard = if_else(
str_detect(sample_id, "STD"),
TRUE,
FALSE
),
is.blank = if_else(
str_detect(sample_id, "BLANK"),
TRUE,
FALSE
),
is.empty = if_else(
str_detect(sample_id, "EMPTY"),
TRUE,
FALSE
)
)
# Chunk 8
mean_blank <- cline_data |>
filter(is.blank) |>
pull(values) |>
mean()
paste("The average blank absorbance value at 670 nm is", mean_blank)
# Chunk 9
standard_data <- cline_data |>
filter(is.standard) |>
left_join(standard_concs, by = "sample_id") |>
select(-c(is.standard, is.blank, is.empty)) |>
mutate(abs.corrected = values - mean_blank)
p_std_curve <- standard_data |>
filter(concentration.um < 150) |>
ggplot(
aes(y = concentration.um,
x = abs.corrected
)
) +
ggpmisc::stat_poly_line(method = "lm") +
geom_point(aes(color = sample_id),
alpha = 0.7) +
ggpmisc::stat_poly_eq(use_label(c("eq", "R2"))) +
labs(
y = "Concentration (µM)",
x = "Absorbance (670nm)"
) +
theme_bw()
p_std_curve
plotly::ggplotly()
# get equation
std_curve <- lm(data =standard_data |> filter(concentration.um < 150),
concentration.um ~ abs.corrected
) |> broom::tidy()
std_int <- std_curve |> filter(term == "(Intercept)") |> pull(estimate)
std_slope <- std_curve |> filter(term == "abs.corrected") |> pull(estimate)
# Define a function that converts absorbance 670 to concentration of free sulfide
convert_670_to_conc <- function(abs, slope, int) {
return((abs * std_slope) + std_int)
}
# Chunk 10
cline_data_corrected <- cline_data |>
# filter out non-samples
filter(!is.standard, !is.blank, !is.empty) |>
# average 3 replicates
group_by(sample_id) |>
summarize(abs.mean = mean(values),
abs.sd = sd(values)) |>
ungroup() |>
# add dilution factor
mutate(
DF = case_when(
str_detect(sample_id, "DIL1") ~ 10,
TRUE ~ 1
)
) |>
# correct the absorbance values by subtracting blanks and multiplying by DF
mutate(
abs.corrected = if_else(
abs.mean - mean_blank >= 0,
true = (abs.mean - mean_blank) * DF,
false = 0
)
) |>
# calculate um from standard curve equation
mutate(
conc.um = convert_670_to_conc(
abs = abs.corrected,
slope = std_slope,
int = std_int
),
sd.conc.um = convert_670_to_conc(
abs = abs.sd,
slope = std_slope,
int = std_int
)) |>
# correct for dilution of adding to ZnAc solution
# 400 µL diluted to 1400µL is a DF of 3.5
mutate(
conc.um = conc.um * 3.5
) |>
# Add metadata
mutate(
well = case_when(
str_detect(sample_id, "BA1B") ~ "BA1B",
str_detect(sample_id, "BA3A") ~ "BA3A",
str_detect(sample_id, "BA4A") ~ "BA4A",
TRUE ~ NA
),
depth = case_when(
str_detect(sample_id, "20") ~ 20,
str_detect(sample_id, "150") ~ 150,
str_detect(sample_id, "250") ~ 250,
str_detect(sample_id, "270") ~ 270,
),
amendment = case_when(
str_detect(sample_id, "BIC") ~ "Bicarbonate",
str_detect(sample_id, "AC") ~ "Acetate",
str_detect(sample_id, "F") ~ "Formate",
str_detect(sample_id, "CTL") ~ "Control",
)
) |>
# remove diluted samples:
# none of our samples are outside the dynamic range of the instrument!
#filter(!str_detect(sample_id, "DIL")) |>
mutate(label = if_else(
conc.um > 3,
true = as.character(round(conc.um, 1)),
false = "ND"
)) |>
filter(!sample_id %in% diluted_samples) |>
# add timepoint information
mutate(
sample_set = "B"
)
custom_order <- c("Acetate", "Bicarbonate", "Formate", "Control")
cline_data_corrected |>
mutate(amendment = fct_relevel(amendment, custom_order)) |>
ggplot() +
aes(
x = amendment,
y = conc.um,
label = label
) +
geom_col(fill = "black", width = 0.5) +
geom_text(aes(y = conc.um - (0.1 * conc.um)),
size = 2, color = "white") +
facet_wrap(vars(well, depth), scales = "free_y") +
scale_y_continuous(expand = c(0, 0)) +
theme_bw() +
labs(
x = "Amendment",
y = "Sulfide Concentration (µM)"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
panel.grid.major.y = element_line(linetype = "dotted", color = "gray"),
panel.grid.minor.y = element_blank()
)
#plotly::ggplotly()
# Chunk 1
rm(list=ls()) # Clear the environment
library(tidyverse)
library(ggrepel)
# Chunk 2
df1 <- read_rds("cache/2023-05-23-cline_data.RDS")
df2 <- read_rds("cache/2023-06-05-cline_data.RDS")
# combine the two datasets
clines <- bind_rows(df1, df2) |>
mutate(dt = case_when(
sample_set == "CTL" ~ 0,
sample_set == "B" ~ 118,
sample_set == "A" ~ 34,
))
# pull the controls
clines_ctls <- clines |> filter(amendment == "Control") |>
#rename(CTL.conc.um = conc.um) |>
select(conc.um, sd.conc.um, well, depth) |>
crossing(amendment = c("Acetate", "Formate", "Bicarbonate")) |>
mutate(sample_set = "CTL",
dt = 0)
clines_wctls <- clines |>
filter(amendment != "Control") |>
bind_rows(clines_ctls)
rm(df1, df2) # remove excess tibbles
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
clines_wctls |>
mutate(depth.str = paste(depth, "m")) |>
mutate(depth.str = fct_reorder(.f = depth.str, .x = depth)) |>
ggplot(
aes(x = dt,
y = conc.um,
color = amendment,
linetype = amendment,
shape = amendment)
) +
geom_point() +
scale_color_manual(values = amendment_palette) +
geom_line() +
geom_errorbar(aes(
ymin = conc.um - sd.conc.um,
ymax = conc.um + sd.conc.um
),
width = 3,
linetype = "solid"
) +
facet_wrap(vars(well, depth.str)) +
theme_bw() +
labs(
x = "Incubation Time (Days)",
y = "Total Sulfide (µM)"
)
amendment_palette <- c("#9c0000", "#004e9c", "#003b09")
clines_wctls |>
mutate(depth.str = paste(depth, "m")) |>
mutate(depth.str = fct_reorder(.f = depth.str, .x = depth)) |>
ggplot(
aes(x = dt,
y = conc.um,
color = amendment,
linetype = amendment,
shape = amendment)
) +
geom_point() +
scale_color_manual(values = amendment_palette) +
geom_line() +
geom_errorbar(aes(
ymin = conc.um - sd.conc.um,
ymax = conc.um + sd.conc.um
),
width = 3,
linetype = "solid"
) +
facet_wrap(vars(well, depth.str), scales = "free_y") +
theme_bw() +
labs(
x = "Incubation Time (Days)",
y = "Total Sulfide (µM)"
)
